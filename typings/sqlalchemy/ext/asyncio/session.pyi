"""
This type stub file was generated by pyright.
"""

from .base import ReversibleProxy, StartableContext
from ... import util
from ...orm import Session

@util.create_proxy_methods(Session, ":class:`_orm.Session`", ":class:`_asyncio.AsyncSession`", classmethods=["object_session", "identity_key"], methods=["__contains__", "__iter__", "add", "add_all", "expire", "expire_all", "expunge", "expunge_all", "get_bind", "is_modified", "in_transaction", "in_nested_transaction"], attributes=["dirty", "deleted", "new", "identity_map", "is_active", "autoflush", "no_autoflush", "info"])
class AsyncSession(ReversibleProxy):
    """Asyncio version of :class:`_orm.Session`.


    .. versionadded:: 1.4

    """
    __slots__ = ...
    dispatch = ...
    def __init__(self, bind=..., binds=..., **kw) -> None:
        ...
    
    async def refresh(self, instance, attribute_names=..., with_for_update=...):
        """Expire and refresh the attributes on the given instance.

        A query will be issued to the database and all attributes will be
        refreshed with their current database value.

        This is the async version of the :meth:`_orm.Session.refresh` method.
        See that method for a complete description of all options.

        """
        ...
    
    async def run_sync(self, fn, *arg, **kw):
        """Invoke the given sync callable passing sync self as the first
        argument.

        This method maintains the asyncio event loop all the way through
        to the database connection by running the given callable in a
        specially instrumented greenlet.

        E.g.::

            with AsyncSession(async_engine) as session:
                await session.run_sync(some_business_method)

        .. note::

            The provided callable is invoked inline within the asyncio event
            loop, and will block on traditional IO calls.  IO within this
            callable should only call into SQLAlchemy's asyncio database
            APIs which will be properly adapted to the greenlet context.

        .. seealso::

            :ref:`session_run_sync`
        """
        ...
    
    async def execute(self, statement, params=..., execution_options=..., bind_arguments=..., **kw):
        """Execute a statement and return a buffered
        :class:`_engine.Result` object."""
        ...
    
    async def scalar(self, statement, params=..., execution_options=..., bind_arguments=..., **kw):
        """Execute a statement and return a scalar result."""
        ...
    
    async def get(self, entity, ident, options=..., populate_existing=..., with_for_update=..., identity_token=...):
        """Return an instance based on the given primary key identifier,
        or ``None`` if not found.


        """
        ...
    
    async def stream(self, statement, params=..., execution_options=..., bind_arguments=..., **kw): # -> AsyncResult:
        """Execute a statement and return a streaming
        :class:`_asyncio.AsyncResult` object."""
        ...
    
    async def delete(self, instance):
        """Mark an instance as deleted.

        The database delete operation occurs upon ``flush()``.

        As this operation may need to cascade along unloaded relationships,
        it is awaitable to allow for those queries to take place.


        """
        ...
    
    async def merge(self, instance, load=...):
        """Copy the state of a given instance into a corresponding instance
        within this :class:`_asyncio.AsyncSession`.

        """
        ...
    
    async def flush(self, objects=...): # -> None:
        """Flush all the object changes to the database.

        .. seealso::

            :meth:`_orm.Session.flush`

        """
        ...
    
    def get_transaction(self): # -> None:
        """Return the current root transaction in progress, if any.

        :return: an :class:`_asyncio.AsyncSessionTransaction` object, or
         ``None``.

        .. versionadded:: 1.4.18

        """
        ...
    
    def get_nested_transaction(self): # -> None:
        """Return the current nested transaction in progress, if any.

        :return: an :class:`_asyncio.AsyncSessionTransaction` object, or
         ``None``.

        .. versionadded:: 1.4.18

        """
        ...
    
    async def connection(self): # -> None:
        r"""Return a :class:`_asyncio.AsyncConnection` object corresponding to
        this :class:`.Session` object's transactional state.

        """
        ...
    
    def begin(self, **kw): # -> AsyncSessionTransaction:
        """Return an :class:`_asyncio.AsyncSessionTransaction` object.

        The underlying :class:`_orm.Session` will perform the
        "begin" action when the :class:`_asyncio.AsyncSessionTransaction`
        object is entered::

            async with async_session.begin():
                # .. ORM transaction is begun

        Note that database IO will not normally occur when the session-level
        transaction is begun, as database transactions begin on an
        on-demand basis.  However, the begin block is async to accommodate
        for a :meth:`_orm.SessionEvents.after_transaction_create`
        event hook that may perform IO.

        For a general description of ORM begin, see
        :meth:`_orm.Session.begin`.

        """
        ...
    
    def begin_nested(self, **kw): # -> AsyncSessionTransaction:
        """Return an :class:`_asyncio.AsyncSessionTransaction` object
        which will begin a "nested" transaction, e.g. SAVEPOINT.

        Behavior is the same as that of :meth:`_asyncio.AsyncSession.begin`.

        For a general description of ORM begin nested, see
        :meth:`_orm.Session.begin_nested`.

        """
        ...
    
    async def rollback(self):
        """Rollback the current transaction in progress."""
        ...
    
    async def commit(self):
        """Commit the current transaction in progress."""
        ...
    
    async def close(self):
        """Close out the transactional resources and ORM objects used by this
        :class:`_asyncio.AsyncSession`.

        This expunges all ORM objects associated with this
        :class:`_asyncio.AsyncSession`, ends any transaction in progress and
        :term:`releases` any :class:`_asyncio.AsyncConnection` objects which
        this :class:`_asyncio.AsyncSession` itself has checked out from
        associated :class:`_asyncio.AsyncEngine` objects. The operation then
        leaves the :class:`_asyncio.AsyncSession` in a state which it may be
        used again.

        .. tip::

            The :meth:`_asyncio.AsyncSession.close` method **does not prevent
            the Session from being used again**. The
            :class:`_asyncio.AsyncSession` itself does not actually have a
            distinct "closed" state; it merely means the
            :class:`_asyncio.AsyncSession` will release all database
            connections and ORM objects.


        .. seealso::

            :ref:`session_closing` - detail on the semantics of
            :meth:`_asyncio.AsyncSession.close`

        """
        ...
    
    @classmethod
    async def close_all(self):
        """Close all :class:`_asyncio.AsyncSession` sessions."""
        ...
    
    async def __aenter__(self): # -> AsyncSession:
        ...
    
    async def __aexit__(self, type_, value, traceback): # -> None:
        ...
    


class _AsyncSessionContextManager:
    def __init__(self, async_session) -> None:
        ...
    
    async def __aenter__(self):
        ...
    
    async def __aexit__(self, type_, value, traceback): # -> None:
        ...
    


class AsyncSessionTransaction(ReversibleProxy, StartableContext):
    """A wrapper for the ORM :class:`_orm.SessionTransaction` object.

    This object is provided so that a transaction-holding object
    for the :meth:`_asyncio.AsyncSession.begin` may be returned.

    The object supports both explicit calls to
    :meth:`_asyncio.AsyncSessionTransaction.commit` and
    :meth:`_asyncio.AsyncSessionTransaction.rollback`, as well as use as an
    async context manager.


    .. versionadded:: 1.4

    """
    __slots__ = ...
    def __init__(self, session, nested=...) -> None:
        ...
    
    @property
    def is_active(self): # -> Literal[False]:
        ...
    
    async def rollback(self): # -> None:
        """Roll back this :class:`_asyncio.AsyncTransaction`."""
        ...
    
    async def commit(self): # -> None:
        """Commit this :class:`_asyncio.AsyncTransaction`."""
        ...
    
    async def start(self, is_ctxmanager=...): # -> AsyncSessionTransaction:
        ...
    
    async def __aexit__(self, type_, value, traceback): # -> None:
        ...
    


def async_object_session(instance): # -> None:
    """Return the :class:`_asyncio.AsyncSession` to which the given instance
    belongs.

    This function makes use of the sync-API function
    :class:`_orm.object_session` to retrieve the :class:`_orm.Session` which
    refers to the given instance, and from there links it to the original
    :class:`_asyncio.AsyncSession`.

    If the :class:`_asyncio.AsyncSession` has been garbage collected, the
    return value is ``None``.

    This functionality is also available from the
    :attr:`_orm.InstanceState.async_session` accessor.

    :param instance: an ORM mapped instance
    :return: an :class:`_asyncio.AsyncSession` object, or ``None``.

    .. versionadded:: 1.4.18

    """
    ...

def async_session(session): # -> None:
    """Return the :class:`_asyncio.AsyncSession` which is proxying the given
    :class:`_orm.Session` object, if any.

    :param session: a :class:`_orm.Session` instance.
    :return: a :class:`_asyncio.AsyncSession` instance, or ``None``.

    .. versionadded:: 1.4.18

    """
    ...

